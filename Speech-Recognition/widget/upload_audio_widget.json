{
  "alias": "upload_audio_file",
  "name": "Upload Audio",
  "descriptor": {
    "type": "latest",
    "sizeX": 8,
    "sizeY": 5.5,
    "resources": [],
    "templateHtml": "<!--Load Audio file:-->\r\n<div fxFlex fxLayout=\"column\" style=\"height: 100%;\"\r\n     fxLayoutAlign=\"center stretch\">\r\n    <input id=\"audio_file\" type=\"file\" accept=\"audio/*\" />\r\n    <p>\r\n    <audio controls id=\"audio_player\"></audio>\r\n    </p>\r\n</div>",
    "templateCss": "",
    "controllerScript": "self.onInit = function() {\r\n\r\n    self.ctx.$scope.data = self.ctx.defaultSubscription.data;\r\n    \r\n    audio_file.onchange = function() {\r\n        console.log(\"Uploaded audio file\");\r\n        var files = this.files;\r\n        try{\r\n            var file = URL.createObjectURL(files[0]);\r\n            console.log(\"see file\",file)\r\n            audio_player.src = file;\r\n            var player = document.getElementById(\"audio_player\");\r\n            console.info('audio_source', audio_player);\r\n            player.addEventListener(\"play\", function () {\r\n                audio_player.play();\r\n                getData();\r\n            \r\n            });\r\n        }\r\n        catch(e){\r\n            alert(\"Please choose a file\");\r\n        }\r\n        \r\n        function getData() {\r\n            if(window.webkitAudioContext) {\r\n                audioCtx = new window.webkitAudioContext();\r\n            } else {\r\n                audioCtx = new AudioContext({sampleRate: 16000})\r\n            }\r\n            //var source = audioCtx.createBufferSource();\r\n            var request = new XMLHttpRequest();\r\n            request.open('GET', file, true);\r\n            request.responseType = 'arraybuffer';\r\n            request.onload = function() {\r\n                let audioData = request.response;\r\n                audioCtx.decodeAudioData(audioData, function(buffer) {\r\n                    var myBuffer = buffer;\r\n                    var audio_data = myBuffer.getChannelData(0);\r\n                    //var sample_rate = myBuffer.sampleRate;\r\n                    console.info(\"audio data length\",audio_data.length);\r\n                    //audio array\r\n                    var audio_array = []; \r\n                    for(var i=0;i<audio_data.length;i++){\r\n                        audio_array.push(audio_data[i]);\r\n                    }\r\n                    console.info(\"audio array\",audio_array);\r\n                    self.ctx.deviceService\r\n                        .getDeviceCredentials(self.ctx\r\n                            .datasources[0].entityId)\r\n                        .subscribe(function(response) {\r\n                            url = \"/api/v1/\" + response.credentialsId + \"/telemetry\";\r\n                            data = {\r\n                                \"input\": audio_array\r\n                            };\r\n                            \r\n                            console.log(\"widget upload audio is running\");\r\n                            $.ajax({\r\n                                    url: url,\r\n                                    type: 'post',\r\n                                    data: JSON.stringify(data),\r\n                                    headers: {\r\n                                        'Content-Type': 'application/json'\r\n                                    },\r\n                                    dataType: 'json',\r\n                                    success: function(postResponse) {\r\n                                        console.info(\"telemetry done. \" + postResponse);\r\n                                    }\r\n                                });\r\n                        });\r\n                },\r\n                function(e){\"Error with decoding audio data\" + e.error});\r\n            }\r\n            request.send();\r\n            console.log(\"Server should receive data\");\r\n        }\r\n    };\r\n};\r\n\r\nself.onDataUpdated = function() {\r\n    self.ctx.detectChanges();\r\n}\r\n",
    "settingsSchema": "{}",
    "dataKeySettingsSchema": "{}\n",
    "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Upload Audio\"}"
  },
  "image": "data:image/jpeg;base64,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",
  "description": "For sending audio to a rule chain input"
}
